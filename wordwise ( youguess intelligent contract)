# { "Depends": "py-genlayer:latest" }
import genlayer.gl as gl

class YouGuess(gl.Contract):
    # Persistent state variable declaration [2]
    current_game_data: str 

    def __init__(self):
        # Initialize with valid JSON [9]
        self.current_game_data = '{"word": "GAME", "definition": "An activity for entertainment or competition."}'

    @gl.public.write
    def generate_new_word(self) -> str:
        prompt = (
            "You are a word game engine. Your ONLY output must be a single, "
            "unformatted JSON object. DO NOT use markdown. Generate a random, "
            "common 4-letter English word and its definition. "
            "Structure: { \"word\": \"[word]\", \"definition\": \"[definition]\" }."
        )

        task = "Generate a 4-letter word and definition in JSON."
        criteria = (
            "1. Output must be valid JSON.\n"
            "2. 'word' must be exactly 4 letters.\n"
            "3. 'definition' must be a valid string description."
        )

        # Non-comparative equivalence is best for subjective NLP tasks [10]
        result: str = gl.eq_principle.prompt_non_comparative(
            lambda: gl.nondet.exec_prompt(prompt),
            task=task,
            criteria=criteria
        )
        
        # FIX: Sanitize the result to remove markdown backticks before saving [3, 4]
        sanitized_result = result.replace("```json", "").replace("```", "").strip()
        
        self.current_game_data = sanitized_result
        return sanitized_result

    @gl.public.view
    def get_game_data(self) -> str:
        # Returns the sanitized JSON string stored on-chain [2]
        return self.current_game_data
